<element name="gk-ajax">

  <template>
    <div id="{{id}}" url="{{url}}" dataType="{{handleAs}}" data="{{data}}" type="{{method}}" headers="{{headers}}" contentType="{{contentType}}" withCredentials="{{withCredentials}}" xhrFields="{{xhrArgs}}" auto="{{auto}}"></div>
  </template>

  <script>
  function getAjaxSettings($ele) {
    var settings = {};
    ['url', 'dataType', 'type', 'contentType'].forEach(function(attr) {
      settings[attr] = $ele.attr(attr);
    });
    ['data', 'headers', 'xhrFields'].forEach(function(attr) {
      var json = $ele.attr(attr);
      json && (settings[attr] = JSON.parse(json));
    });
    settings.xhrFields = settings.xhrFields || {};
    settings.xhrFields.withCredentials = !!$ele.attr('withCredentials');
    settings.success = function(resp) {
      $ele.gk().response = resp;
      $ele.trigger('response', arguments);
    };
    settings.error = function() {
      $ele.trigger('error', arguments);
    };
    settings.complete = function() {
      $ele.trigger('complete', arguments);
    };
    return settings;
  }

  registerElement('gk-ajax', {

    response: null,

    init: function() {
      var auto = this.$ele.attr('auto');
      if (typeof auto !== 'undefined' && auto !== 'false') {
        this.go();
      }
    },

    go: function() {
      $.ajax(getAjaxSettings(this.$ele));
    }

  });
  </script>

</element>
