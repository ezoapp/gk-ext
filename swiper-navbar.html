<script src="../swiper/dist/idangerous.swiper.min.js"></script>

<element name="swiper-navbar">

  <template>
    <link rel="stylesheet" href="../swiper/dist/idangerous.swiper.css">
    <link rel="stylesheet" href="./swiper-navbar/swiper-navbar.css">
    <div id="{{id}}" style="{{style}}" class="swiper-container">
      <div class="swiper-wrapper">
        <content></content>
      </div>
    </div>
  </template>

  <script>

  function swiper(instance) {
      var self = instance,
              $oriEle = self.$originEle,
              $ele = self.$ele,
              key = $oriEle.attr('key'),
              swiper,
              onSlideClickCallback,
              selected;

      var settings = {
          calculateHeight: $oriEle.attr('calculateHeight') === 'false' ? false : true,
          freeMode: $oriEle.attr('freeMode') === 'false' ? false : true,
          freeModeFluid: $oriEle.attr('freeModeFluid') === 'false' ? false : true,
          slidesPerView: $oriEle.attr('slidesPerView') ? +$oriEle.attr('slidesPerView') : 'auto',
          onSlideChangeStart: function () {
              $ele.triggerHandler('onSlideChangeStart', arguments);
          },
          onSlideClick: function (swiper) {
              $ele.one('onSlideClick', _clickSlide);
              $ele.triggerHandler('onSlideClick', arguments);
          }
      };

      function _clickSlide(event, swiper) {
          $('.swiper-navbar-active', $ele).removeClass('swiper-navbar-active');
          var index = swiper.clickedSlideIndex,
                  slide = swiper.getSlide(index);
          $(slide).addClass('swiper-navbar-active');

          if (!onSlideClickCallback) {
              return;
          }

          var vo = slide.getData(index),
                  providerParams = {
                      'event': event,
                      'swiper': swiper,
                      'vo': vo,
                      'idx': index
                  },
                  params = $.gk.getParamNames(onSlideClickCallback),
                  injectionParams = [];

          selected = vo;
          $.each(params, function (idx, obj) {
              injectionParams.push(providerParams[obj]);
          });
          onSlideClickCallback.apply(self, injectionParams);
      }

      self.getSelected = function () {
          return selected;
      };

      self.onSlideClick = function (callback) {
          onSlideClickCallback = callback;
      };

      self.swiper = function () {
          return swiper;
      };

      self.renderUI = function (data) {
          if (data && data.length > 0) {
              selected = data[0];
          }
          _doRender(data);
      };

      self.swipeTo = function (index) {
          swiper.clickedSlideIndex = index;
          _clickSlide(undefined, swiper);
      };

      function _doRender(data) {
          swiper.removeAllSlides();
          for (var i = 0; i < data.length; i++) {
              var text;
              if (key) {
                  text = data[i][key];
              } else {
                  text = data[i];
              }
              var newSlide = swiper.createSlide('<span class="swiper-navbar">' + text + '</span>');
              if (i === 0) {
                  $(newSlide).addClass('swiper-navbar-active');
              }
              newSlide.setData(i, data[i]);
              swiper.appendSlide(newSlide);
          }
      }

      swiper = $ele.swiper(settings);
  }

  registerElement('swiper-navbar', {
    init: function() {
      new swiper(this);
    }
  });
  </script>

</element>
