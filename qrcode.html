<script src='../jquery.qrcode/src/qrcode.js'></script>
<script src='../jquery.qrcode/src/jquery.qrcode.js'></script>
<script>
requirejs.config({
  context: 'gk',
  shim: {
    'components/jquery.qrcode/src/jquery.qrcode': {
      deps: ['components/jquery.qrcode/src/qrcode']
    }
  }
});
</script>

<element name='qrcode'>

  <template>
    <div id='{{id}}' render='{{render}}' style='{{style}}' size='{{size}}'>
      <content></content>
    </div>
  </template>

  <script>
  registerElement('qrcode', {

    text: '',

    init: function() {
      var $ele = this.$ele;
      if ($ele.attr('size') != '{{size}}') {
        var size = $ele.attr('size');
        $ele.css({
          'width': size,
          'height': size
        });
      }
      this.render(this.$originEle.text());
    },

    render: function(txt) {
      var $ele = this.$ele;
      if (this.text !== txt) {
        this.text = txt;
        $ele.html('');
        $ele.qrcode({
          render: $ele.attr('render'),
          background: '#fff',
          size: parseInt($ele.attr('size'), 10),
          text: txt
        });
      }
    }

  });
  </script>

</element>
